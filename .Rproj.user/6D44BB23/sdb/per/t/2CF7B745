{
    "collab_server" : "",
    "contents" : "library(data.table)\nlibrary(tidyverse)\n#----read da----\nbase_path <- 'F:\\\\SpiderPy3\\\\page0904\\\\aroundbind\\\\'\nall_paths <- map_chr(list.files(base_path),function(x){return (str_c(base_path,x))})\ntest <- read.csv(all_paths[1])\nnames(test)\nmode(test)\n\nall_changdu<- all_paths %>% map(function(x){return(names(fread(x)))}) %>% reduce(function(x,y){return(intersect(x,y))})\ntest %>% dplyr::select(setdiff(all_changdu,c('V1')))\nall_files <- all_paths %>% map_df(function(x){return(read.csv(x,colClasses = c(gridcode = 'character'))%>%dplyr::select(setdiff(all_changdu,c('V1'))) )}) %>% as.data.table()\ndata <- all_files\nfwrite(data,'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\youyiku.csv')\n#----- before deal----\nstr(data)\ndata[,.N,filename]\ndata[,':='(shop_id = sapply(filename,get_shop_id)),]\ndata <- as.data.table(data)\nget_shop_id <- function(a){\n  str_split(a,'_')[[1]][1]\n}\ndata[,.N,.(shop_id)]\nstr(data)\nget_shop_id('440_22')\ndata[,.N,pname]\n# write.csv(data[,.N,name],'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\stock_name.csv')\nstr(data)\ndata[,,]\npp <- read.csv('C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\stock_name.csv')\npp <- as.data.table(pp)[,.(name,name_used),]\nstr(data)\ndata_n <- data[,.(cityname,pname,citycode,type,typecode,filename,shop_id,business_area,name),]\ndata_n <- data_n%>%left_join(pp,by=c('name')) %>% as.data.table()\ndata_n[name_used=='优衣库',,]\n\ncity_rank <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\城市级别匹配表.txt')\nsetnames(city_rank,names(city_rank),c('provi_z','cityname','city_rank_z','xingzheng_z'))\npp_new <- city_rank[,.(cityname,city_rank_z),] \nPP_new <- pp_new[!duplicated(pp_new)]\n\nsetdiff(as.vector(unique(data_n$cityname)),as.vector(unique(PP_new$cityname)))\ndata_n <- data_n %>% left_join(pp_new,by=c('cityname')) %>% as.data.table()\n\n\ndata_youyiku <- fread('F:\\\\SpiderPy3\\\\page0904\\\\re\\\\uniqlo_around.csv',encoding = 'UTF-8')\ndata_youyiku <- data_youyiku %>% left_join(pp_new,by=c('cityname')) %>% as.data.table()\ndata_youyiku <- data_youyiku[!duplicated(data_youyiku)]\n#---- data_youyiku----\ndata_youyiku[,.N,pname]\ndata_youyiku[pname=='上海市'&name=='优衣库(塘桥巴黎春天店)',,]\ndata_youyiku[,.N,city_rank_z]\ndata_youyiku[city_rank_z=='五线城市',,]\nwrite.csv(data_youyiku[,.N,city_rank_z]\n          \n  ,'clipboard')\n#---- data_circle----\ndata_n[,.N,type][order(-N)]\nfwrite(data_n[type=='购物服务;商场;购物中心',.N,name_used][order(-N)],\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\zhengti_tem.csv')\ntemaa <- data_n[city_rank_z %in% c('一线城市','二线城市'),.N,type][order(-N)]\ntema <- data_n[city_rank_z %in% c('一线城市','二线城市')&type=='购物服务;购物相关场所;购物相关场所',.N,name_used][order(-N)]\ntemb <-data_n[city_rank_z %in% c('一线城市','二线城市')&type=='购物服务;便民商店/便利店;便民商店/便利店',.N,name_used][order(-N)]\ntemc <-data_n[city_rank_z %in% c('一线城市','二线城市')&type=='购物服务;服装鞋帽皮具店;品牌服装店',.N,name_used][order(-N)]\ntemd <-data_n[city_rank_z %in% c('一线城市','二线城市')&type=='购物服务;商场;购物中心',.N,name_used][order(-N)]\nfwrite(temaa,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\12_aa.csv')\nfwrite(tema,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\12_a.csv')\nfwrite(temb,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\12_b.csv')\nfwrite(temc,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\12_c.csv')\nfwrite(temd,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\12_d.csv')\ntemaa <- data_n[city_rank_z %in% c('三线城市','四线城市'),.N,type][order(-N)]\ntema <- data_n[city_rank_z %in% c('三线城市','四线城市')&type=='购物服务;购物相关场所;购物相关场所',.N,name_used][order(-N)]\ntemb <-data_n[city_rank_z %in% c('三线城市','四线城市')&type=='购物服务;便民商店/便利店;便民商店/便利店',.N,name_used][order(-N)]\ntemc <-data_n[city_rank_z %in% c('三线城市','四线城市')&type=='购物服务;服装鞋帽皮具店;品牌服装店',.N,name_used][order(-N)]\ntemd <-data_n[city_rank_z %in% c('三线城市','四线城市')&type=='购物服务;商场;购物中心',.N,name_used][order(-N)]\nfwrite(temaa,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\34_aa.csv')\nfwrite(tema,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\34_a.csv')\nfwrite(temb,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\34_b.csv')\nfwrite(temc,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\34_c.csv')\nfwrite(temd,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\34_d.csv')\n\ntemaa <- data_n[city_rank_z %in% c('新一线城市'),.N,type][order(-N)]\ntema <- data_n[city_rank_z %in% c('新一线城市')&type=='购物服务;购物相关场所;购物相关场所',.N,name_used][order(-N)]\ntemb <-data_n[city_rank_z %in% c('新一线城市')&type=='购物服务;便民商店/便利店;便民商店/便利店',.N,name_used][order(-N)]\ntemc <-data_n[city_rank_z %in% c('新一线城市')&type=='购物服务;服装鞋帽皮具店;品牌服装店',.N,name_used][order(-N)]\ntemd <-data_n[city_rank_z %in% c('新一线城市')&type=='购物服务;商场;购物中心',.N,name_used][order(-N)]\nfwrite(temaa,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\new1_aa.csv')\nfwrite(tema,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\new1_a.csv')\nfwrite(temb,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\new1_b.csv')\nfwrite(temc,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\new1_c.csv')\nfwrite(temd,\n       'C:\\\\Users\\\\hasee\\\\Desktop\\\\youyiku\\\\new1_d.csv')\n\n",
    "created" : 1536305600164.000,
    "dirty" : false,
    "encoding" : "CP936",
    "folds" : "2|12|13|62|\n",
    "hash" : "3880484970",
    "id" : "2CF7B745",
    "lastKnownWriteTime" : 1536306656,
    "last_content_update" : 1536306656384,
    "path" : "E:/Rworkspace/DemoR/machineLearning/Friend_Cicle.R",
    "project_path" : "Friend_Cicle.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}
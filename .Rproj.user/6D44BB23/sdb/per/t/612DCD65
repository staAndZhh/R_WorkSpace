{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(data.table)\nlibrary(lubridate)\nlibrary(arules)\n\nread_da <-function(name_paths,header = FALSE){\n   dat  <- fread(name_paths,header = FALSE)\n   return (dat)\n}\n\nDeal_data <- function(dat){\n  deal_da <- function(da,start,end){\n   str_sub(str_trim(da),start,end)\n  }\n  deal_qy <- function(da,index){\n     re <- as.vector((str_split(str_trim(da),' ')))[[1]]\n     # if_else(index==1,re[index],re[length(re)])'\n     if(index==1){\n       return(re[index])\n     }else{\n       return(re[length(re)])\n     }\n  }\n  deal_tem <- function(da,index){\n    re <- as.vector(str_extract_all(str_trim(da),'(\\\\d+)')[[1]])\n    if_else(index==1,re[1],re[2])\n  }\n  deal_fengli <- function(da,index){\n    re <- as.vector(str_extract_all(str_trim(da),('\\\\S+'))[[1]])\n    return(re[index])\n  }\n  deal_week <- function(da){\n    da <- as.character(da)\n    if_else(nchar(da)==1,str_c('0',da),da)\n  }\n  deal_new_week <- function(da){\n    da <- ymd(da)\n    return(week(da))\n  }\n  \n  dat[,\":=\"(year = deal_da(V1,1,4)),]  # data\n  dat[,\":=\"(month = deal_da(V1,6,7)),]\n  dat[,\":=\"(day = deal_da(V1,9,10)),]\n  dat[,\":=\"(month = deal_da(V1,6,7)),]\n  dat[,'tianqi_am':=lapply(V2,deal_qy,1),]  # qy\n  dat[,'tianqi_pm':=lapply(V2,deal_qy,-1),]  \n  dat[,'max_tm':=lapply(V3,deal_tem,1),]  # tem\n  dat[,'min_tm':=lapply(V3,deal_tem,-1),] \n  dat[,'fengxiang_t':= lapply(V4,deal_fengli,1),] # fengxiang\n  dat[,'fengxiang_t1':= lapply(V4,deal_fengli,3),] \n  dat[,'fengli':= lapply(V4,deal_fengli,2),] \n  dat[,'fengli1':= lapply(V4,deal_fengli,4),] \n  dat[,'ymd':=str_c(year,month,day),] #ymds\n  dat[,'week':=deal_new_week(ymd),] # newweek\n  dat[,'new_week':=lapply(week,deal_week),] \n  dat[,'yearweek':=str_c(year,new_week),]  # yearweek\n  setnames(dat,'V5','city')\n  \n  dat[,':='(max_tm = as.numeric(max_tm),min_tm = as.numeric(min_tm)),]\n  dat[,\":=\"(ave_tm= (max_tm+min_tm)/2),]\n  return(dat[,.(year,month,day,ymd,city,tianqi_am,tianqi_pm,max_tm,min_tm,fengxiang_t,fengli,yearweek,week,ave_tm),])\n}\n\n\n\n\nrm(dat_02)\n\ndat_002 <- read_da('E:\\\\Map_Rel\\\\month8\\\\month08_0907_04_all_bind.csv')\ndat_003 <- read_da('E:\\\\Map_Rel\\\\month8\\\\month09_0907_04_all_bind.csv')\ndat_02 <- bind_rows(dat_002,dat_003) %>% as.data.table()\n# dat_02<- read_da(\"C:\\\\Users\\\\hasee\\\\Desktop\\\\weather\\\\all.csv\")\n# writeTxt(rbind, \"E:/month23/month02_180224_03.csv\")\n# dat_02<- read_da(\"E:\\\\Map_Rel\\\\month7\\\\month08_0820_04_all_bind.csv\")\n# dat_03<- read_da(\"E:\\\\Map_Rel\\\\month7\\\\month08_0820_03_all_bind.csv\")\n# dat_04<- read_da(\"E:\\\\Map_Rel\\\\month7\\\\month08_0820_02_all_bind.csv\")\n# dat_05 <-read_da(\"E:\\\\Map_Rel\\\\month7\\\\month08_0820_01_all_bind.csv\")\n# \n# dat_02 <- as.data.table(bind_rows(dat_02,dat_03,dat_04,dat_05))\n# dat_02[!duplicated(dat_02)]\n# dat_04<- read_da('E:\\\\Map_Rel\\\\month1804\\\\month04_180416_03.csv')\n\n\ndat02 <- Deal_data(dat_02)\ndat02[,\":=\"(city = lapply(city,function(x){ return (str_split(x,'历史天气预报')[[1]][1])})),]\n# dat03 <- Deal_data(dat_03)\n# dat04 <- Deal_data(dat_04)\n# dat04 <- as.data.table(dat04)\n# dat <- as.data.table(bind_rows(list(dat02,dat03)))\n# str_split(dat02[,.(city),],'历史天气预报')[[1]][1]\n\ndat02 <- as.data.table(dat02)\n\nppb <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\ppb.txt',encoding = 'UTF-8')\n\nfwrite(dat02,'C:\\\\Users\\\\hasee\\\\Desktop\\\\dat02.csv')\ndat02_copy <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\dat02.csv',encoding = 'UTF-8')\n\n# intersect(unique(dat02_copy$city),unique(ppb$area_name))\nsetnames(ppb,names(ppb),c('city','provi','area','s_area','area_name'))\ndat_new <- data.table(left_join(dat02_copy,ppb,by='city'))\nfwrite(dat_new,'C:\\\\Users\\\\hasee\\\\Desktop\\\\dat_new.csv')\n\n# dat_new[,.N,city]\ndat_new[,.N,.(ymd)][N!=2349]\ndat_02\n\n\nstr(dat02_copy)\nstr(ppb)\nstr(dat_new)\ndat_new[is.na(area_name),,]\ndat_new[,.N,by=.(ymd)]\ndat_new[is.na(area_name),.(unique(city)),]\ndat_new[provi=='内蒙???',,]\ndat_new[city=='锡林郭勒',,]\n# unique(dat_new$city)\ndat_new[city=='锡林郭勒',':='(area_name ='xlinguole',provi ='内蒙???',area='华北大区',s_area ='北一' ),]\n\nfwrite(dat_new,'C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0601.csv')\ntemDa <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0601.csv',encoding = 'UTF-8')\nwrite.csv(temDa,'C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0601_0820.csv')\ntemDa <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0601_0820.csv')\ntemDa[,.N,.(provi,month)]\nprint('ending')\n\n# dat_later <-  as.data.table(read.csv('C:\\\\Users\\\\hasee\\\\Desktop\\\\180810\\\\month_later_180818_NEW.csv'))\n\n#-----------------new-------------\ndat_02 <- fread('E:\\\\Map_Rel\\\\monthlater\\\\month_later_180907_NEW.csv',header = TRUE)\ndat_later <-  as.data.table(dat_02)\ndat <- dat_later\nstr(dat)\nDeal_data_month_later <-  function(dat){\n  deal_da <- function(da,index){\n    re <- as.vector((str_extract_all(str_trim(da),'(\\\\d+)'))[[1]])\n    if_else(index==1,re[1],re[2])\n  }\n\n  deal_tem <- function(da,index){\n    re <- as.vector(str_extract_all(str_trim(da),'(\\\\d+)')[[1]])\n    if_else(index==1,re[1],re[2])\n  }\n\n  deal_week <- function(da){\n    da <- as.character(da)\n    if_else(nchar(da)==1,str_c('0',da),da)\n  }\n  deal_new_week <- function(da){\n    da <- ymd(da)\n    return(week(da))\n  }\n  \n  dat[,\":=\"(year = 2018),]  # data\n  dat[,\":=\"(month = lapply(data_str_l,deal_da,1)),]\n  dat[,\":=\"(day = lapply(data_str_l,deal_da,2)),]\n  dat[,\":=\"(month_new=lapply(month,deal_week),day_new = lapply(day,deal_week))]\n  dat[,'ymd':=str_c(year,month_new,day_new),] #ymds\n  \n  setnames(dat,'wea_str_l','tianqi_am')  # qy\n  dat[,'tianqi_pm':='null',]  \n  dat[,'max_tm':=lapply(tem_str_l,deal_tem,-1),]  # tem\n  dat[,'min_tm':=lapply(tem_str_l,deal_tem,1),] \n  dat[,'fengxiang_t':= 'null',] # fengxiang\n  dat[,'fengxiang_t1':= 'null',] \n  dat[,'fengli':= 'null',] \n  dat[,'fengli1':= 'null',] \n \n  dat[,'week':=lapply(ymd,deal_new_week),] # newweek\n  dat[,'new_week':=lapply(week,deal_week),] \n  dat[,'yearweek':=str_c(year,new_week),]  # yearweek\n  setnames(dat,c('SecPag','FirPa'),c('city','provi'))\n  \n  dat[,':='(max_tm = as.numeric(max_tm),min_tm = as.numeric(min_tm)),]\n  dat[,\":=\"(ave_tm= (max_tm+min_tm)/2),]\n  dat[,\":=\"('area' ='暂无区域','s_area' ='暂无区域'),]\n  return(dat[,.(year,month,day,ymd,yearweek,city,tianqi_am,tianqi_pm,max_tm,min_tm,fengxiang_t,fengli,week,ave_tm,provi,area,s_area),])\n}\n\ndat <- Deal_data_month_later(dat)\ndat <- as.data.table(dat)\ndat[,\":=\"(tianqi_pm=NULL),]\nsetnames(dat,'tianqi_am','tianqi_pm')\ndat <- dat[,.(year,month,day,ymd,yearweek,city,tianqi_pm,max_tm,min_tm,ave_tm,provi,area,s_area),]\n# dat[,':='(area=NULL,s_area=NULL),]\n# xlsx::write.xlsx(dat[city%in%c('广州','郑州','杭州','济南','淄博'),,],'C:\\\\Users\\\\hasee\\\\Desktop\\\\next_weather0827.xlsx')\nfwrite(dat,'C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0514.csv')\ntemDa <- fread('C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0514.csv')\nwrite.csv(temDa,'C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0514_0820_later.csv')\nfread('C:\\\\Users\\\\hasee\\\\Desktop\\\\new_da0514_0820_later.csv')\ndat_02\n#----------------------deal apriori lele----------------\n# da_ori <- as.data.table(readxl::read_xlsx('C:\\\\Users\\\\hasee\\\\Desktop\\\\关联分析小票款号_2018-05-04_10-50-57.xlsx',sheet = '分析 1',skip = 3))\n# da_ori[,\":=\"(款号= as.character(款号)),]\n# da_ori[,\":=\"(xxbh=str_c(代理???,门店编码,日历???,sep='-'),sku = str_c(款号,色号,sep = '-')),]\n# da_ori <- as.data.table(da_ori)\n# \n# final_da <- da_ori[!duplicated(da_ori[,.(xxbh,sku),]),.(xxbh,sku),]\n# str(da_ori)\n# \n# final_da_aprior <- final_da[,.(val=list(c(sku))),by=xxbh]\n# lst_tr<-final_da_aprior[,.(val)]\n# trnsData <- as(lst_tr[[1]],\"transactions\")\n# summary(trnsData)\n# \n# #------------test-----------\n# da_ori[da_ori$款号=='13038040101',,]\n# da_ori[da_ori$sku%in%c(\"1303804101-0461\"),,]\n# final_da[final_da$sku=='13038040101-0461',.(unique(xxbh)),]\n# 256/5063\n# \n# Rules<-apriori(data=trnsData,parameter=list(support=0.01,confidence=0.01,target=\"rules\"))\n# summary(Rules)\n# Re_Ru <- subset(Rules,items%in%'13038040101-0461')\n# data.frame(Re_Ru)\n# write(Re_Ru,file = \"C:\\\\Users\\\\hasee\\\\Desktop\\\\lele.csv\",sep=',')\n#",
    "created" : 1536285964329.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "5|46|8|0|\n10|27|61|0|\n133|40|177|0|\n",
    "hash" : "4014917031",
    "id" : "612DCD65",
    "lastKnownWriteTime" : 1536287363,
    "last_content_update" : 1536287922326,
    "path" : "E:/Rworkspace/month3_18/Report_Apriori/apriori/Deal_History_MonthLater_Weather.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}